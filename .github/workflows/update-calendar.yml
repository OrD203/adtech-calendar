name: Update AdTech Event Calendar

on:
  schedule:
    # Run daily at 3 AM UTC
    - cron: '0 3 * * *'
  
  # Allow manual triggers
  workflow_dispatch:

jobs:
  update-calendar:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
      
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'
      
      - name: Install dependencies
        run: |
          pip install requests beautifulsoup4 schedule lxml
      
      - name: Run event updater
        env:
          RUN_ONCE: 'true'
        run: |
          python event_updater.py
      
      - name: Check for changes
        id: git-check
        run: |
          git diff --exit-code events.json || echo "changed=true" >> $GITHUB_OUTPUT
      
      - name: Commit and push changes
        if: steps.git-check.outputs.changed == 'true'
        run: |
          git config user.name "Calendar Update Bot"
          git config user.email "calendar-bot@adtech.com"
          git add events.json
          git commit -m "Auto-update calendar: $(date -u +%Y-%m-%d)"
          git push
      
      - name: Create summary
        run: |
          echo "## Calendar Update Summary" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "**Update Time**: $(date -u)" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          
          if [ -f events.json ]; then
            TOTAL_EVENTS=$(cat events.json | python3 -c "import sys, json; print(json.load(sys.stdin)['metadata']['totalEvents'])" 2>/dev/null || echo "Unknown")
            echo "**Total Events**: $TOTAL_EVENTS" >> $GITHUB_STEP_SUMMARY
          fi
          
          if [ "${{ steps.git-check.outputs.changed }}" == "true" ]; then
            echo "**Status**: ✅ Calendar updated with new data" >> $GITHUB_STEP_SUMMARY
          else
            echo "**Status**: ℹ️ No changes detected" >> $GITHUB_STEP_SUMMARY
          fi
```

5. Scroll down and click **"Commit new file"**

---

### **Step 2: Enable GitHub Pages**

1. Click **"Settings"** tab (at the top of your repo)
2. In the left sidebar, scroll down and click **"Pages"**
3. Under **"Source"**, select **"Deploy from a branch"**
4. Under **"Branch"**, select:
   - Branch: **main**
   - Folder: **/ (root)**
5. Click **"Save"**

---

### **Step 3: Wait 1-2 Minutes**

GitHub will build your site. You'll see a message like:
```
"Your site is ready to be published at https://OrD203.github.io/adtech-calendar/"
